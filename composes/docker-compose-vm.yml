name: monitoring

services:
  vmagent:
    image: victoriametrics/vmagent:v1.128.0
    container_name: vmagent
    ports:
      - "127.0.0.1:8429:8429"
    volumes:
      - ../vm-agent/data:/vmagentdata
      - ../vm-agent/scrape_config.yml:/etc/prometheus/scrape_config.yml
    command:
      - "-promscrape.config=/etc/prometheus/scrape_config.yml"
      - "--remoteWrite.url=$VM_REMOTE_WRITE_URL"
      - "--remoteWrite.basicAuth.username=$VM_REMOTE_WRITE_USERNAME"
      - "--remoteWrite.basicAuth.password=$VM_REMOTE_WRITE_PASSWORD"
    restart: unless-stopped
